name: 'Setup SIERRA'
description: 'Setup SIERRA for CI and testing'
# inputs:
  # who-to-greet:  # id of input
  #   description: 'Who to greet'
  #   required: true
  #   default: 'World'
# outputs:
#   time: # id of output
#     description: 'The time we greeted you'
runs:
  using: 'composite'
  steps:
    - name: Setup system
      shell: bash
      run: |
        sudo add-apt-repository -y ppa:deadsnakes/ppa
        sudo apt update

        sudo apt-get install python${{ matrix.python-version }} python${{ matrix.python-version }}-dev
        sudo apt-get install python${{ matrix.python-version }}-venv python3-apt
        sudo apt-get install python3-pip python3-cairo intltool python3-wheel strace
        sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python${{ matrix.python-version }} 1

        python3 -m pip install --upgrade pip

        # HACK HACK HACK!
        sudo ln -s /usr/lib/python3/dist-packages/apt_pkg.cpython-38-x86_64-linux-gnu.so  /usr/lib/python3/dist-packages/apt_pkg.so
        sudo ln -s /usr/lib/python3/dist-packages/netifaces.cpython-38-x86_64-linux-gnu.so  /usr/lib/python3/dist-packages/netifaces.so

        pip3 install wheel


    - name: Install SIERRA system dependencies
      shell: bash
      run: |
        sudo apt-get install parallel cm-super texlive-fonts-recommended
        sudo apt-get install texlive-latex-extra dvipng pssh ffmpeg xvfb

    - name: Install SIERRA
      shell: bash
      run: |
        # Install SIERRA to force installing all of its dependencies from
        # setup.py, to avoid duplicating them here.
        pip3 install -r docs/requirements.txt
        cd docs && make man && cd ..
        pip3 install .
        pip3 install .[devel]
