.. _ln-sierra-usage-stage5:

================
Pipeline Stage 5
================

The main idea of this pipeline stage is to "collate" the results of one or more
:term:`Summary .csv` files present in different :term:`Batch Experiments <Batch
Experiment>` into a :term:`Inter-Batch .csv` file, and then use that file to
generate graphs. Any :term:`Summary .csv` that is present in multiple
:term:`Batch Experiments <Batch Experiment>` can be used during stage 5!  This
gives this pipeline stage tremendous flexibility as a camera-ready graph
generation tool.

In general, stage 5 is always run separate from stages 1-4 (i.e., a separate
SIERRA invocation), because the options are quite different, but you don't
`have` to do this.

.. IMPORTANT:: You *cannot* use this stage before successfully running stage 4
               for each of the :term:`Batch Experiments <Batch Experiment>` you
               want to include on the final graph.


.. WARNING:: Because SIERRA never deletes stuff for you, running stage 5 is
             *NOT* idempotent. Running the same stage 5 invocation comparing 3
             controllers in a single scenario (for example) could result in
             linegraphs containing 3,6,9,..., lines with duplicated data. In
             general, you want to delete the directories generated by stage 5
             between successive runs. See
             :ref:`ln-sierra-usage-runtime-exp-tree` for details on what
             directories are generated.

.. _ln-sierra-usage-stage5-intra-scenario:

Intra-Scenario Comparison
=========================

Intra-scenario comparison compares the of experiments using one or more
controllers on the same ``--scenario``. To use it, you need to pass the
following options to SIERRA (see :ref:`ln-sierra-usage-cli` for documentation):

- ``--scenario-comparison``

- ``--bc-univar`` or ``--bc-bivar``

- ``--dist-stats`` (to get statistics generated during stage 3 to show up on the
  final graph).

Other ``--plot-*`` options providing for fine-grained control of the generated
graphs may also be of interest.

For YAML configuration, see
:ref:`ln-sierra-tutorials-project-stage5-config-intra`.

.. _ln-sierra-usage-stage5-inter-scenario:

Inter-Scenario Comparison
=========================

Inter-scenario comparison compares the same ``--controller`` across multiple
``--scenarios``. To use it, you need to pass the following options to SIERRA
when running stage 5 (see :ref:`ln-sierra-usage-cli` for documentation):

- ``--controller-comparison``

- ``--bc-univar`` or ``--bc-bivar``

- ``--dist-stats`` (to get statistics generated during stage 3 to show up on the
  final graph).

Other ``--plot-*`` options providing for fine-grained control of the generated
graphs may also be of interest.

For YAML configuration, see
:ref:`ln-sierra-tutorials-project-stage5-config-inter`.
